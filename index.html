<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>High Villa Map</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { width: 100%; height: 100%; }
    #error { display: none; padding: 20px; font-family: sans-serif; color: red; text-align: center; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="error">❌ Не удалось загрузить карту. Отключите блокировщики рекламы или попробуйте другой браузер.</div>

  <!-- Подключение API Яндекс.Карт с обработкой ошибки -->
  <script>
    function loadYandexMapsScript(onSuccess, onFailure) {
      const script = document.createElement('script');
      script.src = "https://api-maps.yandex.ru/v3/?apikey=49fdb8ac-c93c-4ad1-8bc9-6d0d3c41359d&lang=ru_RU";
      script.type = "text/javascript";
      script.onload = onSuccess;
      script.onerror = onFailure;
      document.head.appendChild(script);
    }

    // Показать заглушку, если не загрузился API
    function showError() {
      document.getElementById("map").style.display = "none";
      document.getElementById("error").style.display = "block";
    }

    // Попытка загрузить карту
    loadYandexMapsScript(() => {
      ymaps3.ready.then(() => {
        ymaps3.import([
          'YMap',
          'YMapDefaultSchemeLayer',
          'YMapDefaultFeaturesLayer',
          'YMapFeatureCollection',
          'prepareCustomization'
        ]).then(({
          YMap,
          YMapDefaultSchemeLayer,
          YMapDefaultFeaturesLayer,
          YMapFeatureCollection,
          prepareCustomization
        }) => {
          const map = new YMap(document.getElementById('map'), {
            location: { center: [39.967000, 43.486204], zoom: 17 },
            behaviors: ['drag', 'scrollZoom']
          });

          map.addChild(new YMapDefaultFeaturesLayer());

          fetch("https://raw.githubusercontent.com/mtriu/highvilla-map/main/customization.json")
            .then(res => res.json())
            .then(styleData => {
              const customization = prepareCustomization(styleData);
              map.addChild(new YMapDefaultSchemeLayer({ customization }));
            });

          fetch("https://raw.githubusercontent.com/mtriu/highvilla-map/main/High%20Villa_24-06-2025_21-23-39.geojson")
            .then(res => res.json())
            .then(geojson => {
              map.addChild(new YMapFeatureCollection({ features: geojson.features }));
            });
        });
      });
    }, showError);
  </script>
</body>
</html>
